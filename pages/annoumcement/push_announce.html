<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../lib/layui/css/layui.css">
    <link rel="stylesheet" href="../../lib/laydate/theme/default/laydate.css">
    <link href="../../lib/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <style>
    </style>
    <div class="layui-fluid">
        <div class="layui-row layui-col-space10">
            <form action="" class="layui-form">
                <!-- 公告标题和发布时间s  -->
                <div class="layui-col-xs12 layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">公告主题</div>
                        <div class="layui-card-body">
                            <div class="layui-form-item">
                                <div class="layui-input-inline" style="width: 100%;">
                                    <input type="text" name="title" lay-verify="title|required" placeholder="请输入公告主题" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-xs12 layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">发布时间</div>
                        <div class="layui-card-body">
                            <span>设置时间：</span>
                            <div class="layui-form-item layui-inline">
                                <div class="layui-input-inline">
                                    <input type="text" placeholder="开始时间" id="StartTime" class="layui-input" name="startTime" lay-verify="startTime">
                                </div>
                            </div>
                            <div class="layui-form-item layui-inline">
                                <div class="layui-input-inline">
                                    <input type="text" placeholder="结束时间" id="EndTime" class="layui-input" name="endTime" lay-verify="endTime">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 公告标题和发布时间e -->

                <!-- 公告内容s -->
                <div class="layui-col-xs12 layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-header">公告内容</div>
                        <div class="layui-card-body">
                            <script type="text/plain" id="myEditor" style="width:1000px;height:240px;">
                            </script>
                        </div>
                    </div>
                </div>
                <!-- 公告内容e -->
                <!-- <form action="" class="layui-form"> -->
                <!-- 底部部门选择和其他选项 -->
                <div class="layui-col-xs12 layui-col-md12">
                    <div class="layui-row layui-col-space10">
                        <!-- 部门s -->
                        <div class="layui-col-xs12 layui-col-md12">
                            <div class="layui-card">
                                <div class="layui-card-header">接收部门</div>
                                <div class="layui-card-body">
                                    <div class=" layui-row layui-col-space10">
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label">发送部门</label>
                                            <div class="layui-input-inline">
                                                <select name="getdepartment" lay-verify="">
                                                    <option value="">选择接收部门</option>
                                                    <option value="0">部们一</option>
                                                    <option value="1">部门二</option>
                                                    <option value="2">部门三</option>
                                                    <option value="3">部门四</option>
                                                    <option value="4">部门五</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label">接收部门</label>
                                            <div class="layui-input-block">
                                                <input type="button" class="layui-btn" id='addReceiveDepartment' value="增加">
                                                <input type="button" class="layui-btn" id='clearPartDepartmentBtn' value="清空">
                                            </div>
                                            <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px; ">
                                                <div id="parentIframeDepartment" style="margin: 0 auto;width: 90%">
                                                </div>
                                            </blockquote>
                                        </div>
                                        <div class="layui-col-md12">
                                            <label class="layui-form-label">接收用户</label>
                                            <div class="layui-input-block">
                                                <input type="button" class="layui-btn" id='addReceiveUser' value="增加">
                                                <input type="button" class="layui-btn" id='clearPartUserBtn' value="清空">
                                            </div>
                                            <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px; ">
                                                <div id="parentIframeUser" style="margin: 0 auto;width: 90%">
                                                </div>
                                            </blockquote>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 部门e -->

                        <!-- 其他选项s -->
                        <div class="layui-col-xs12 layui-col-md12">
                            <div class="layui-card">
                                <div class="layui-card-header">其他选项</div>
                                <div class="layui-card-body">
                                    <div class="layui-inline">
                                        <div class="layui-form-item">
                                            <div class="layui-inline">
                                                <div class="layui-input-inline">
                                                    <input type="checkbox" name="valid" lay-verify="valid" title="是否长期有效" lay-skin="primary" checked>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <div class="layui-input-inline">
                                                <button id="formSubmitBtn" class="layui-btn" lay-submit lay-filter="form">立即提交</button>
                                                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 其他选项e -->
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script type="text/javascript" src="../../lib/laydate/laydate.js"></script>
    <script type="text/javascript" src="../../lib/layui/layui.all.js"></script>
    <script type="text/javascript" src="../../js/index.js"></script>

    <script>
        var $ = layui.jquery;
        //需要全局声明，子ifream才能取到
        layui.use(['form', 'layer'], function () {
            var form = layui.form,
                layer = layui.layer,
                clearPartDepartmentBtn = $('#clearPartDepartmentBtn'),
                clearPartUserBtn = $('#clearPartUserBtn'),
                parentIframeDepartment = $('#parentIframeDepartment'),
                parentIframeUser = $('#parentIframeUser'),
                addReceiveDepartment = $('#addReceiveDepartment'),
                addReceiveUser = $('#addReceiveUser');

            addReceiveDepartment.on('click', function () {
                layer.open({
                    type: 2,
                    area: ['700px', '550px'],
                    fixed: false, //不固定
                    maxmin: true,
                    content: '../others/receivedepartment.html'
                });
            });
            addReceiveUser.on('click', function () {
                layer.open({
                    type: 2,
                    area: ['700px', '550px'],
                    fixed: false, //不固定
                    maxmin: true,
                    content: '../others/receiveuser.html',
                });
            })

            // 清空选区事件clearPrecinct
            clearPartDepartmentBtn.on('click', function () {
                clearPrecinct(parentIframeDepartment, 'departmentArr');
            });
            clearPartUserBtn.on('click', function () {
                clearPrecinct(parentIframeUser, 'userArr');
            });

            function clearPrecinct(precinct, data) {
                if (getFatherIframeContentDepartment()) {
                    layer.confirm('确认清空?', {
                        btn: ['确认', '取消'] //按钮
                    }, function () {
                        layer.msg('清除成功', {
                            icon: 1
                        });
                        precinct.children().remove();
                        object[data] = [];
                    }, function () {
                        layer.close();
                    });
                } else {
                    layer.msg('内容为空');
                }
            }
            function getFatherIframeContentDepartment() {
                var parentIframe = $('#parentIframeDepartment'),
                    allReceiveDepartment = [],
                    itemId = parentIframe.find(".itemId");
                for (var i = 0; i < itemId.length; i++) {
                    allReceiveDepartment.push(itemId.eq(i).text());
                }
                if (allReceiveDepartment.length === 0) {
                    return false;
                } else {
                    return allReceiveDepartment;
                }
            };

            function getFatherIframeContentUser() {
                var parentIframe = $('#parentIframeUser'),
                    allReceiveUser = [],
                    itemId = parentIframe.find(".itemId");
                for (var i = 0; i < itemId.length; i++) {
                    allReceiveUser.push(itemId.eq(i).text());
                }
                if (allReceiveUser.length === 0) {
                    return false;
                } else {
                    return allReceiveUser;
                }
            };
            form.on('submit(form)', function (data) {
                var a = getFatherIframeContent.init({
                    parentIframe: 'parentIframeUser',
                    itemId: '.itemId',
                    isSetSession: false
                });
                umConfig.getContent();
                alert(a);
                if (a.length > 0) {
                    avoidDuplicationOfSubmission($('#formSubmitBtn'));
                    $.ajax({
                        url: '',
                        type: '',
                        success: function (res) {
                            self.location.reload();
                        }
                    })
                } else {
                    layer.alert('请检查部门参数等不能为空!');
                }
                return false;
            });
            $(document).on('click', '#delBtn_u', function () {
                $(this).parent('.userItm').remove();
                var itemId = $(this).siblings('.itemId').text();
                removeItem(object.userArr, itemId);
            })

            $(document).on('click', '#delBtn_d', function () {
                $(this).parent('.userItm').remove();
                var itemId = $(this).siblings('.itemId').text();
                removeItem(object.departmentArr, itemId);
            })

        });
        laydate.render({
            elem: '#StartTime',
            type: 'datetime'
        });
        laydate.render({
            elem: '#EndTime',
            type: 'datetime'
        });
    </script>
    <script src="../../lib/umeditor/third-party/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../lib/umeditor/umeditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../lib/umeditor/umeditor.min.js"></script>
    <script type="text/javascript" src="../../lib/umeditor/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript" src="../../js/umeditor_config.js"></script>
</body>

</html>